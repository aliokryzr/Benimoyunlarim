<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>🍳 Yemek Tarifi Önerileri 🍳</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Georgia, serif; }
    body { background: #0d1117; color: #c9d1d9; display: flex; flex-direction: column; align-items: center; padding: 2rem; }
    .container, .results-frame {
      background: #161b22; border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
      width: 100%; max-width: 600px; margin-bottom: 1.5rem;
    }
    .container { padding: 2rem; }
    .container h1 { margin-bottom: 1rem; font-size: 1.8rem; text-align: center; color: #58a6ff; }
    .container p { margin-bottom: 0.5rem; }
    .container input {
      width: 100%; padding: 0.6rem; margin-bottom: 0.8rem;
      border: 1px solid #30363d; border-radius: 4px; font-size: 1rem;
      background: #0d1117; color: #c9d1d9;
    }
    .container button {
      width: 100%; padding: 0.7rem;
      background: #238636; color: #f0f6fc; border: none; border-radius: 4px;
      cursor: pointer; font-size: 1rem;
    }
    .container button:hover { background: #2ea043; }
    .contact { margin-top: 0.5rem; text-align: center; color: #8b949e; font-size: 0.9rem; }
    .contact a { color: #58a6ff; text-decoration: none; }

    .results-frame { display: none; padding: 2rem; }
    .results-frame h2 { font-size: 1.6rem; margin-bottom: 0.5rem; color: #58a6ff; }
    .hint { font-size: 0.9rem; margin-bottom: 1rem; color: #8b949e; }
    #message { margin-bottom: 1rem; font-style: italic; }
    #results { list-style: none; padding: 0; }
    #results li {
      background: #0d1117; margin-bottom: 1rem; padding: 1rem;
      border: 1px solid #30363d; border-radius: 6px;
    }
    .recipe-title {
      font-size: 1.3rem; margin-bottom: 0.6rem; color: #58a6ff;
      cursor: pointer;
    }
    .ings { display: flex; justify-content: space-between; }
    .ings div { width: 48%; }
    .ings strong { display: block; margin-bottom: 0.4rem; color: #ffea7f; }
    .ings ul { list-style: disc; margin-left: 1.2rem; }
    hr { border: none; border-top: 1px solid #30363d; margin: 1rem 0; }

    .instructions {
      background: #161b22; padding: 0.8rem; border-radius: 4px;
      margin-top: 0.5rem; color: #c9d1d9;
    }
    .instructions ol { margin-left: 1.2rem; }
    .instructions li { margin-bottom: 0.4rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🍳 Yemek Tarifi Önerileri 🍳</h1>
    <p>Elindeki malzemeleri virgülle ayırıp yaz:</p>
    <input type="text" id="ingredients" placeholder="örn: patates, yumurta, un">
    <button id="searchBtn">Tarif Ara</button>
    <p class="contact">İletişim: <a href="mailto:Ali@Siber.NET">Ali@Siber.NET</a></p>
  </div>

  <div class="results-frame" id="results-container">
    <h2>Sonuçlar</h2>
    <p class="hint">Yapılışını görmek için başlığa tıkla</p>
    <div id="message"></div>
    <ul id="results"></ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const apiKey = '117f4267981845d5800cb8de69f44e23';

      // Dinamik çeviri API’si (LibreTranslate)
      async function libreTranslate(text, source, target) {
        try {
          const res = await fetch('https://libretranslate.de/translate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ q: text, source, target, format: 'text' })
          });
          const json = await res.json();
          return json.translatedText;
        } catch {
          return text;
        }
      }
      const toEnglish = txt => libreTranslate(txt, 'tr', 'en');
      const toTurkish = txt => libreTranslate(txt, 'en', 'tr');

      const searchBtn = document.getElementById('searchBtn');
      const ingInput  = document.getElementById('ingredients');
      const msgDiv    = document.getElementById('message');
      const ulResults = document.getElementById('results');
      const resultsContainer = document.getElementById('results-container');

      async function searchRecipes() {
        const raw = ingInput.value.trim();
        if (!raw) return alert('Lütfen en az bir malzeme giriniz!');

        const ingList = raw.split(',').map(s => s.trim()).filter(Boolean);

        // Başlangıç: çeviri mesajı
        resultsContainer.style.display = 'none';
        ulResults.innerHTML = '';
        msgDiv.textContent = 'Malzemeler otomatik olarak İngilizceye çevriliyor… ⏳';

        let enIngredients;
        try {
          enIngredients = await Promise.all(ingList.map(toEnglish));
        } catch {
          return alert('Malzemeler çevirilirken hata oluştu.');
        }

        const suggestions = ingList.map((tr, i) => `${tr} → ${enIngredients[i]}`).join(', ');
        msgDiv.innerHTML = `Çeviri önerileri: ${suggestions}<br>Tarif aranıyor…`;

        setTimeout(async () => {
          try {
            const query = encodeURIComponent(enIngredients.join(','));
            const res = await fetch(
              `https://api.spoonacular.com/recipes/findByIngredients?ingredients=${query}&number=5&apiKey=${apiKey}`
            );
            if (!res.ok) throw new Error(res.status);
            const data = await res.json();

            resultsContainer.style.display = 'block';
            if (!data.length) {
              msgDiv.textContent = 'Bu malzemelerle tarif bulunamadı 😕';
              return;
            }
            msgDiv.textContent = `Bulunan ${data.length} tarif:`;

            for (let i = 0; i < data.length; i++) {
              const t = data[i];
              const li = document.createElement('li');

              // Başlık
              const titleEl = document.createElement('div');
              titleEl.className = 'recipe-title';
              titleEl.dataset.id = t.id;
              titleEl.textContent = `${i+1}. ${t.title}`;
              toTurkish(t.title).then(tr => {
                titleEl.textContent = `${i+1}. ${tr}`;
              });
              li.appendChild(titleEl);

              // Malzemeler (Türkçe)
              const usedTr   = await Promise.all(t.usedIngredients.map(u => toTurkish(u.name)));
              const missedTr = await Promise.all(t.missedIngredients.map(u => toTurkish(u.name)));

              const ingsDiv = document.createElement('div');
              ingsDiv.className = 'ings';
              [['Kullanılabilir:', t.usedIngredients, usedTr],
               ['Eksik:',          t.missedIngredients, missedTr]
              ].forEach(([lbl, arr, names]) => {
                const block = document.createElement('div');
                const strong = document.createElement('strong');
                strong.textContent = lbl;
                block.appendChild(strong);
                const ul = document.createElement('ul');
                arr.forEach((u,j) => {
                  const liU = document.createElement('li');
                  liU.textContent = `${names[j]} (${u.amount} ${u.unit})`;
                  ul.appendChild(liU);
                });
                block.appendChild(ul);
                ingsDiv.appendChild(block);
              });
              li.appendChild(ingsDiv);
              li.appendChild(document.createElement('hr'));

              // Talimatlar (tıklayınca aç/kapa)
              titleEl.onclick = async () => {
                let instrDiv = li.querySelector('.instructions');
                if (instrDiv) {
                  instrDiv.style.display = instrDiv.style.display === 'block' ? 'none' : 'block';
                  return;
                }
                instrDiv = document.createElement('div');
                instrDiv.className = 'instructions';
                instrDiv.textContent = 'Yükleniyor…';
                li.appendChild(instrDiv);

                try {
                  let info = await fetch(
                    `https://api.spoonacular.com/recipes/${t.id}/analyzedInstructions?apiKey=${apiKey}`
                  ).then(r => r.json());
                  let steps = info[0]?.steps?.map(s => s.step) || [];

                  if (!steps.length) {
                    const info2 = await fetch(
                      `https://api.spoonacular.com/recipes/${t.id}/information?includeNutrition=false&apiKey=${apiKey}`
                    ).then(r => r.json());
                    steps = info2.analyzedInstructions[0]?.steps?.map(s => s.step) || [];
                    if (!steps.length && info2.instructions) {
                      instrDiv.innerHTML = info2.instructions;
                      return;
                    }
                  }

                  if (steps.length) {
                    const trs = await Promise.all(steps.map(s => toTurkish(s)));
                    instrDiv.innerHTML = '<ol>' + trs.map(st => `<li>${st}</li>`).join('') + '</ol>';
                  } else {
                    instrDiv.textContent = 'Tarif adımları bulunamadı.';
                  }
                } catch {
                  instrDiv.textContent = 'Adımlar yüklenirken hata oluştu.';
                }
              };

              ulResults.appendChild(li);
            }
          } catch {
            msgDiv.textContent = 'Bir hata oluştu, lütfen konsolu kontrol edin.';
          }
        }, 2500);
      }

      searchBtn.addEventListener('click', searchRecipes);
    });
  </script>
</body>
</html>
