<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Tarif √ñneri Uygulamasƒ±</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Georgia, serif; }
    body { background: #0d1117; color: #c9d1d9; display: flex; flex-direction: column; align-items: center; padding: 2rem; }
    .container, .results-frame {
      background: #161b22;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
      width: 100%; max-width: 600px; margin-bottom: 1.5rem;
    }
    .container { padding: 2rem; }
    .container h1 { margin-bottom: 1rem; font-size: 1.8rem; text-align: center; color: #58a6ff; }
    .container p { margin-bottom: 0.5rem; }
    .container input {
      width: 100%; padding: 0.6rem; margin-bottom: 0.8rem;
      border: 1px solid #30363d; border-radius: 4px; font-size: 1rem;
      background: #0d1117; color: #c9d1d9;
    }
    .container button {
      width: 100%; padding: 0.7rem;
      background: #238636; color: #f0f6fc; border: none; border-radius: 4px;
      cursor: pointer; font-size: 1rem;
    }
    .container button:hover { background: #2ea043; }
    .contact { margin-top: 0.5rem; text-align: center; color: #8b949e; font-size: 0.9rem; }
    .contact a { color: #58a6ff; text-decoration: none; }
    /* Yeni uyarƒ± satƒ±rƒ± */
    #warning {
      margin-top: 0.5rem; text-align: center;
      color: #f0ad4e; font-size: 0.9rem; min-height: 1.2em;
    }

    .results-frame { display: none; padding: 2rem; }
    .results-frame h2 { font-size: 1.6rem; margin-bottom: 0.5rem; color: #58a6ff; }
    .hint { font-size: 0.9rem; margin-bottom: 1rem; color: #8b949e; }
    #message { margin-bottom: 1rem; font-style: italic; }
    #results { list-style: none; padding: 0; }
    #results li {
      background: #0d1117; margin-bottom: 1rem; padding: 1rem;
      border: 1px solid #30363d; border-radius: 6px;
    }
    .recipe-title {
      font-size: 1.3rem; margin-bottom: 0.6rem; color: #58a6ff; cursor: pointer;
    }
    .ings { display: flex; justify-content: space-between; }
    .ings div { width: 48%; }
    .ings strong { display: block; margin-bottom: 0.4rem; color: #ffea7f; }
    .ings ul { list-style: disc; margin-left: 1.2rem; }
    hr { border: none; border-top: 1px solid #30363d; margin: 1rem 0; }

    .instructions {
      background: #161b22; padding: 0.8rem; border-radius: 4px;
      margin-top: 0.5rem; color: #c9d1d9;
    }
    .instructions ol { margin-left: 1.2rem; }
    .instructions li { margin-bottom: 0.4rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üç≥ Yemek Tarifi √ñnerileri üç≥</h1>
    <p>Elindeki malzemeleri virg√ºlle ayƒ±rƒ±p yaz:</p>
    <input type="text" id="ingredients" placeholder="√∂rn: domates, soƒüan, patates">
    <button id="searchBtn">Tarif Ara</button>
    <p class="contact">ƒ∞leti≈üim: <a href="mailto:Ali@Siber.NET">Ali@Siber.NET</a></p>
    <!-- Uyarƒ± mesajƒ± buraya gelecek -->
    <p id="warning"></p>
  </div>

  <div class="results-frame" id="results-container">
    <h2>Sonu√ßlar</h2>
    <p class="hint">Yapƒ±lƒ±≈üƒ±nƒ± g√∂rmek i√ßin ba≈ülƒ±ƒüa tƒ±kla</p>
    <div id="message"></div>
    <ul id="results"></ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // T√ºrk√ße‚Üíƒ∞ngilizce sabit harita
      const staticMap = {
        domates: 'tomato',
        soƒüan:   'onion',
        biber:   'pepper',
        tavuk:   'chicken',
        patates: 'potato',
        yumurta: 'egg',
        un:      'flour',
        s√ºt:     'milk',
        yulaf:   'oats',
        √ßilek:   'strawberry'
      };

      // Google Translate client-side helper
      async function translate(text, sl, tl) {
        try {
          const res = await fetch(
            `https://translate.googleapis.com/translate_a/single?client=gtx` +
            `&sl=${sl}&tl=${tl}&dt=t&q=${encodeURIComponent(text)}`
          );
          const arr = await res.json();
          return arr[0].map(item => item[0]).join('') || text;
        } catch {
          return text;
        }
      }
      async function toEnglish(tr) {
        const key = tr.trim().toLowerCase();
        return staticMap[key] || await translate(tr, 'tr','en');
      }
      async function toTurkish(en) {
        return await translate(en, 'en','tr');
      }

      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      const searchBtn       = document.getElementById('searchBtn');
      const ingInput        = document.getElementById('ingredients');
      const warningP        = document.getElementById('warning');
      const msgDiv          = document.getElementById('message');
      const ulResults       = document.getElementById('results');
      const resultsContainer= document.getElementById('results-container');

      searchBtn.addEventListener('click', async () => {
        const raw = ingInput.value.trim();
        if (!raw) return alert('L√ºtfen en az bir malzeme giriniz!');
        const list = raw.split(',').map(s => s.trim()).filter(Boolean);

        // Uyarƒ± ve 1.5 sn bekleme
        warningP.textContent = 'Veri tabanƒ± belirtilen malzemeler aranƒ±yor‚Ä¶ ‚è≥';
        await sleep(1500);
        warningP.textContent = '';

        // Malzemeleri ƒ∞ngilizceye √ßevir
        const enList = await Promise.all(list.map(toEnglish));

        // Ba≈ülangƒ±√ß mesajƒ±
        msgDiv.textContent = 'Tarifler getiriliyor‚Ä¶ ‚è≥';
        ulResults.innerHTML = '';
        resultsContainer.style.display = 'none';

        try {
          // Her malzeme i√ßin filter sorgusu
          const mealArrays = await Promise.all(enList.map(async ing => {
            const r = await fetch(
              `https://www.themealdb.com/api/json/v1/1/filter.php?i=${encodeURIComponent(ing)}`
            );
            const j = await r.json();
            return j.meals || [];
          }));

          // Kesi≈üim: t√ºm malzemelerde ortak olan tarif ID‚Äôleri
          const idSets = mealArrays.map(arr => new Set(arr.map(m => m.idMeal)));
          const commonIds = mealArrays[0]
            .map(m => m.idMeal)
            .filter(id => idSets.every(s => s.has(id)));

          resultsContainer.style.display = 'block';
          if (!commonIds.length) {
            msgDiv.textContent = 'Bu malzemelerle tarif bulunamadƒ± üòï';
            return;
          }
          msgDiv.textContent = `Bulunan ${commonIds.length} tarif:`;

          // map: id‚Üímeal objesi (ilk diziden)
          const mealsMap = Object.fromEntries(mealArrays[0].map(m => [m.idMeal, m]));

          // Listele
          for (let i = 0; i < commonIds.length; i++) {
            const id = commonIds[i], m = mealsMap[id];
            const li = document.createElement('li');

            // Ba≈ülƒ±k
            const titleEl = document.createElement('div');
            titleEl.className  = 'recipe-title';
            titleEl.dataset.id = id;
            titleEl.textContent= `${i+1}. ${m.strMeal}`;
            toTurkish(m.strMeal).then(tr => {
              titleEl.textContent = `${i+1}. ${tr}`;
            });
            li.appendChild(titleEl);
            li.appendChild(document.createElement('hr'));
            ulResults.appendChild(li);

            // Tƒ±klanƒ±nca detaylarƒ± g√∂ster
            titleEl.onclick = async () => {
              let instrDiv = li.querySelector('.instructions');
              if (instrDiv) {
                instrDiv.style.display = instrDiv.style.display === 'block' ? 'none' : 'block';
                return;
              }
              instrDiv = document.createElement('div');
              instrDiv.className = 'instructions';
              instrDiv.textContent = 'Detaylar y√ºkleniyor‚Ä¶';
              li.appendChild(instrDiv);

              // lookup u√ß noktasƒ±
              const rd = await fetch(
                `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`
              );
              const { meals } = await rd.json();
              const meal = meals[0];

              // T√ºm malzemeler + √∂l√ß√ºler
              const all = [];
              for (let n = 1; n <= 20; n++) {
                const name = meal[`strIngredient${n}`]?.trim();
                const measure = meal[`strMeasure${n}`]?.trim();
                if (name) all.push({ name, measure });
              }

              // Kullanƒ±labilir / Eksik ayrƒ±mƒ±
              const userSet = new Set(list.map(x => x.toLowerCase()));
              const used  = all.filter(x => userSet.has(x.name.toLowerCase()));
              const missed= all.filter(x => !userSet.has(x.name.toLowerCase()));

              // Adƒ±mlar
              const steps = meal.strInstructions.split(/\r?\n/).filter(l => l.trim());

              // T√ºrk√ßele≈ütir
              const usedTr   = await Promise.all(used.map(x => toTurkish(x.name)));
              const missedTr = await Promise.all(missed.map(x => toTurkish(x.name)));
              const stepsTr  = await Promise.all(steps.map(s => toTurkish(s)));

              // Render
              instrDiv.innerHTML = `
                <strong>Kullanƒ±labilir Malzemeler:</strong>
                <ul>${used.map((u,j) => `<li>${usedTr[j]} ‚Äì ${u.measure}</li>`).join('')}</ul>
                <strong>Eksik Malzemeler:</strong>
                <ul>${missed.map((u,j) => `<li>${missedTr[j]} ‚Äì ${u.measure}</li>`).join('')}</ul>
                <hr>
                <strong>Yapƒ±lƒ±≈ü Adƒ±mlarƒ±:</strong>
                <ol>${stepsTr.map(s => `<li>${s}</li>`).join('')}</ol>`;
            };
          }
        } catch (e) {
          console.error(e);
          msgDiv.textContent = 'Bir hata olu≈ütu, l√ºtfen tekrar deneyin.';
        }
      });
    });
  </script>
</body>
</html>
