<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>üç≥ Yemek Tarifi √ñnerileri üç≥</title>
  <style>
    * { box-sizing:border-box; margin:0; padding:0; font-family:Georgia,serif; }
    body { background:#0d1117; color:#c9d1d9; display:flex; flex-direction:column; align-items:center; padding:2rem; }
    .container, .results-frame {
      background:#161b22; border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,0.6);
      width:100%; max-width:600px; margin-bottom:1.5rem;
    }
    .container { padding:2rem; }
    .container h1 { margin-bottom:1rem; font-size:1.8rem; text-align:center; color:#58a6ff; }
    .container p { margin-bottom:0.5rem; }
    .container input {
      width:100%; padding:0.6rem; margin-bottom:0.8rem;
      border:1px solid #30363d; border-radius:4px; font-size:1rem;
      background:#0d1117; color:#c9d1d9;
    }
    .container button {
      width:100%; padding:0.7rem;
      background:#238636; color:#f0f6fc; border:none; border-radius:4px;
      cursor:pointer; font-size:1rem;
    }
    .container button:hover { background:#2ea043; }
    .contact { margin-top:0.5rem; text-align:center; color:#8b949e; font-size:0.9rem; }
    .contact a { color:#58a6ff; text-decoration:none; }
    #warning {
      margin-top:0.5rem; text-align:center;
      color:#f0ad4e; font-size:0.9rem; min-height:1.2em;
    }

    .results-frame { display:none; padding:2rem; }
    .results-frame h2 { font-size:1.6rem; margin-bottom:0.5rem; color:#58a6ff; }
    .hint { font-size:0.9rem; margin-bottom:1rem; color:#8b949e; }
    #message { margin-bottom:1rem; font-style:italic; }
    #results { list-style:none; padding:0; }
    #results li {
      background:#0d1117; margin-bottom:1rem; padding:1rem;
      border:1px solid #30363d; border-radius:6px;
    }
    .recipe-title {
      font-size:1.3rem; margin-bottom:0.6rem; color:#58a6ff;
      cursor:pointer;
    }
    .ings { display:flex; justify-content:space-between; }
    .ings div { width:48%; }
    .ings strong { display:block; margin-bottom:0.4rem; color:#ffea7f; }
    .ings ul { list-style:disc; margin-left:1.2rem; }
    hr { border:none; border-top:1px solid #30363d; margin:1rem 0; }

    .instructions {
      background:#161b22; padding:0.8rem; border-radius:4px;
      margin-top:0.5rem; color:#c9d1d9;
    }
    .instructions ol { margin-left:1.2rem; }
    .instructions li { margin-bottom:0.4rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üç≥ Yemek Tarifi √ñnerileri üç≥</h1>
    <p>Elindeki malzemeleri virg√ºlle ayƒ±rƒ±p yaz:</p>
    <input type="text" id="ingredients" placeholder="√∂rn: domates, soƒüan, patates">
    <button id="searchBtn">Tarif Ara</button>
    <p class="contact">ƒ∞leti≈üim: <a href="mailto:Ali@Siber.NET">Ali@Siber.NET</a></p>
    <p id="warning"></p>
  </div>

  <div class="results-frame" id="results-container">
    <h2>Sonu√ßlar</h2>
    <p class="hint">Yapƒ±lƒ±≈üƒ±nƒ± g√∂rmek i√ßin ba≈ülƒ±ƒüa tƒ±kla</p>
    <div id="message"></div>
    <ul id="results"></ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Google Translate √ºzerinden basit √ßeviri
      async function toEnglish(text) {
        try {
          const res = await fetch(
            `https://translate.googleapis.com/translate_a/single?client=gtx&sl=tr&tl=en&dt=t&q=${encodeURIComponent(text)}`
          );
          const arr = await res.json();
          return arr[0].map(item => item[0]).join('') || text;
        } catch {
          return text;
        }
      }
      async function toTurkish(text) {
        try {
          const res = await fetch(
            `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=tr&dt=t&q=${encodeURIComponent(text)}`
          );
          const arr = await res.json();
          return arr[0].map(item => item[0]).join('') || text;
        } catch {
          return text;
        }
      }

      function sleep(ms) {
        return new Promise(r => setTimeout(r, ms));
      }

      const searchBtn = document.getElementById('searchBtn');
      const ingInput  = document.getElementById('ingredients');
      const warningP  = document.getElementById('warning');
      const msgDiv    = document.getElementById('message');
      const ulResults = document.getElementById('results');
      const resultsContainer = document.getElementById('results-container');

      searchBtn.addEventListener('click', async () => {
        const raw = ingInput.value.trim();
        if (!raw) return alert('L√ºtfen en az bir malzeme giriniz!');

        // 1) TR‚ÜíEN √ßeviri
        const ingList = raw.split(',').map(s => s.trim()).filter(Boolean);
        const enList  = await Promise.all(ingList.map(toEnglish));
        const query   = enList.join(',');

        // 2) Uyarƒ± mesajƒ± ve kƒ±sa bekleme
        warningP.textContent = 'Veritabanƒ±nda malzemelere g√∂re tarifler aranƒ±yor‚Ä¶ L√ºtfen bekleyiniz.';
        await sleep(3000);
        warningP.textContent = '';

        // 3) TheMealDB filter endpoint
        resultsContainer.style.display = 'none';
        msgDiv.textContent = 'Tarifler getiriliyor‚Ä¶ ‚è≥';
        ulResults.innerHTML = '';

        try {
          const res   = await fetch(
            `https://www.themealdb.com/api/json/v1/1/filter.php?i=${encodeURIComponent(query)}`
          );
          const json  = await res.json();
          const meals = json.meals;

          resultsContainer.style.display = 'block';
          if (!meals) {
            msgDiv.textContent = 'Bu malzemelerle tarif bulunamadƒ± üòï';
            return;
          }
          msgDiv.textContent = `Bulunan ${meals.length} tarif:`;

          for (let i = 0; i < meals.length; i++) {
            const m  = meals[i];
            const li = document.createElement('li');

            // Ba≈ülƒ±k
            const titleEl = document.createElement('div');
            titleEl.className   = 'recipe-title';
            titleEl.dataset.id  = m.idMeal;
            titleEl.textContent = `${i+1}. ${m.strMeal}`;
            toTurkish(m.strMeal).then(tr => {
              titleEl.textContent = `${i+1}. ${tr}`;
            });
            li.appendChild(titleEl);

            // Burada malzemeleri detay √ßaƒürƒ±sƒ±ndan sonra g√∂stereceƒüiz
            li.appendChild(document.createElement('hr'));
            ulResults.appendChild(li);

            // Tƒ±klanƒ±nca detaylarƒ± (malzeme+adƒ±m) getir
            titleEl.onclick = async () => {
              let instrDiv = li.querySelector('.instructions');
              if (instrDiv) {
                instrDiv.style.display = instrDiv.style.display === 'block' ? 'none' : 'block';
                return;
              }
              instrDiv = document.createElement('div');
              instrDiv.className = 'instructions';
              instrDiv.textContent = 'Detaylar y√ºkleniyor‚Ä¶';
              li.appendChild(instrDiv);

              // lookup endpoint
              const detRes = await fetch(
                `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${m.idMeal}`
              );
              const detJson = await detRes.json();
              const meal    = detJson.meals[0];

              // T√ºm malzemeler + √∂l√ß√ºleri
              const allIngr = [];
              for (let n=1; n<=20; n++) {
                const name = meal[`strIngredient${n}`];
                const mea  = meal[`strMeasure${n}`];
                if (name && name.trim()) {
                  allIngr.push({ name: name.trim(), measure: mea.trim() });
                }
              }
              // Kullanƒ±labilir / Eksik hesaplama
              const userSet = new Set(ingList.map(i=>i.toLowerCase()));
              const used    = allIngr.filter(i=> userSet.has(i.name.toLowerCase()));
              const missed  = allIngr.filter(i=> !userSet.has(i.name.toLowerCase()));

              // Adƒ±mlarƒ± par√ßalara ayƒ±r
              const steps = meal.strInstructions
                .split(/\r?\n/)
                .filter(l=>l.trim());

              // Hepsini T√ºrk√ßeye √ßevir
              const usedTr    = await Promise.all(used.map(i=> toTurkish(i.name)));
              const missedTr  = await Promise.all(missed.map(i=> toTurkish(i.name)));
              const stepsTr   = await Promise.all(steps.map(s=> toTurkish(s)));

              // Render
              instrDiv.innerHTML = `
                <strong>Kullanƒ±labilir Malzemeler:</strong>
                <ul>
                  ${used.map((u,idx)=>`<li>${usedTr[idx]} ‚Äì ${u.measure}</li>`).join('')}
                </ul>
                <strong>Eksik Malzemeler:</strong>
                <ul>
                  ${missed.map((u,idx)=>`<li>${missedTr[idx]} ‚Äì ${u.measure}</li>`).join('')}
                </ul>
                <hr>
                <strong>Yapƒ±lƒ±≈ü Adƒ±mlarƒ±:</strong>
                <ol>${stepsTr.map(s=>`<li>${s}</li>`).join('')}</ol>
              `;
            };
          }
        } catch (err) {
          console.error(err);
          msgDiv.textContent = 'Bir hata olu≈ütu, l√ºtfen tekrar deneyiniz.';
        }
      });
    });
  </script>
</body>
</html>
