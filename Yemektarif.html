<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Tarif √ñneri Uygulamasƒ±</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Georgia, serif; }
    body { background: #0d1117; color: #c9d1d9; display: flex; flex-direction: column; align-items: center; padding: 2rem; }
    .container, .results-frame {
      background: #161b22;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
      width: 100%;
      max-width: 600px;
      margin-bottom: 1.5rem;
    }
    .container { padding: 2rem; }
    .container h1 { margin-bottom: 1rem; font-size: 1.8rem; text-align: center; color: #58a6ff; }
    .container p { margin-bottom: 0.5rem; }
    .container input {
      width: 100%; padding: 0.6rem; margin-bottom: 0.8rem;
      border: 1px solid #30363d; border-radius: 4px; font-size: 1rem;
      background: #0d1117; color: #c9d1d9;
    }
    .container button {
      width: 100%; padding: 0.7rem;
      background: #238636; color: #f0f6fc; border: none; border-radius: 4px;
      cursor: pointer; font-size: 1rem;
    }
    .container button:hover { background: #2ea043; }
    .contact { margin-top: 0.5rem; text-align: center; color: #8b949e; font-size: 0.9rem; }
    .contact a { color: #58a6ff; text-decoration: none; }

    .results-frame { display: none; padding: 2rem; }
    .results-frame h2 { font-size: 1.6rem; margin-bottom: 0.5rem; color: #58a6ff; }
    .hint { font-size: 0.9rem; margin-bottom: 1rem; color: #8b949e; }
    #message { margin-bottom: 1rem; font-style: italic; }
    #results { list-style: none; padding: 0; }
    #results li {
      background: #0d1117; margin-bottom: 1rem; padding: 1rem;
      border: 1px solid #30363d; border-radius: 6px;
    }
    .recipe-title {
      font-size: 1.3rem; margin-bottom: 0.6rem; color: #58a6ff;
      cursor: pointer;
    }
    .ings { display: flex; justify-content: space-between; }
    .ings div { width: 48%; }
    .ings strong { display: block; margin-bottom: 0.4rem; color: #ffea7f; }
    .ings ul { list-style: disc; margin-left: 1.2rem; }
    hr { border: none; border-top: 1px solid #30363d; margin: 1rem 0; }

    .instructions {
      background: #161b22; padding: 0.8rem; border-radius: 4px;
      margin-top: 0.5rem; color: #c9d1d9;
    }
    .instructions ol { margin-left: 1.2rem; }
    .instructions li { margin-bottom: 0.4rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üç≥ Yemek Tarifi √ñnerileri üç≥</h1>
    <p>Elindeki malzemeleri virg√ºlle ayƒ±rƒ±p yaz:</p>
    <input type="text" id="ingredients" placeholder="√∂rn: patates, yumurta, un">
    <button id="searchBtn">Tarif Ara</button>
    <p class="contact">ƒ∞leti≈üim: <a href="mailto:Ali@Siber.NET">Ali@Siber.NET</a></p>
  </div>

  <div class="results-frame" id="results-container">
    <h2>Sonu√ßlar</h2>
    <p class="hint">Yapƒ±lƒ±≈üƒ±nƒ± g√∂rmek i√ßin ba≈ülƒ±ƒüa tƒ±kla</p>
    <div id="message"></div>
    <ul id="results"></ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const apiKey = '117f4267981845d5800cb8de69f44e23';

      const translateAPI = (text, from, to) =>
        fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${from}|${to}`)
          .then(r => r.json())
          .then(j => j.responseData.translatedText)
          .catch(() => text);

      const translateTurToEng = txt => translateAPI(txt, 'tr', 'en');
      const translateEngToTur = txt => translateAPI(txt, 'en', 'tr');

      const searchBtn = document.getElementById('searchBtn');
      const ingInput = document.getElementById('ingredients');
      const msgDiv = document.getElementById('message');
      const ulResults = document.getElementById('results');
      const resultsContainer = document.getElementById('results-container');

      async function searchRecipes() {
        const raw = ingInput.value.trim();
        if (!raw) return alert('L√ºtfen en az bir malzeme giriniz!');

        const ingList = raw.split(',').map(s => s.trim()).filter(Boolean);

        // 0) Ba≈ülangƒ±√ßta veri tabanƒ± sorgulama mesajƒ±
        resultsContainer.style.display = 'none';
        ulResults.innerHTML = '';
        msgDiv.textContent = 'Uygun malzemeler ile ilgili veri tabanƒ± sorgulanƒ±yor‚Ä¶ ‚è≥';

        // 1) √áeviri a≈üamasƒ±
        let enIngredients;
        try {
          enIngredients = await Promise.all(ingList.map(translateTurToEng));
        } catch {
          return alert('Malzemeler √ßevirilirken bir hata olu≈ütu.');
        }

        const suggestions = enIngredients.map((en, i) => `${ingList[i]} ‚Üí ${en}`).join(', ');
        msgDiv.innerHTML = `√áeviri √∂nerileri: ${suggestions}<br>Tarif aranƒ±yor‚Ä¶`;

        // 2) Kƒ±sa bekleme ve tarif sorgusu
        setTimeout(async () => {
          try {
            const query = enIngredients.join(',');
            const res = await fetch(
              `https://api.spoonacular.com/recipes/findByIngredients?ingredients=${encodeURIComponent(query)}&number=5&apiKey=${apiKey}`
            );
            if (!res.ok) throw new Error(res.status);
            const data = await res.json();

            resultsContainer.style.display = 'block';
            if (!data.length) {
              msgDiv.textContent = 'Bu malzemelerle tarif bulunamadƒ± üòï';
              return;
            }
            msgDiv.textContent = `Bulunan ${data.length} tarif:`;

            for (let i = 0; i < data.length; i++) {
              const t = data[i];
              const li = document.createElement('li');

              // Ba≈ülƒ±k
              const titleEl = document.createElement('div');
              titleEl.className = 'recipe-title';
              titleEl.dataset.id = t.id;
              titleEl.textContent = `${i+1}. ${t.title}`;
              translateEngToTur(t.title).then(tr => {
                titleEl.textContent = `${i+1}. ${tr}`;
              });
              li.appendChild(titleEl);

              // Malzemeler (T√ºrk√ße)
              const usedTr = await Promise.all(t.usedIngredients.map(u => translateEngToTur(u.name)));
              const missedTr = await Promise.all(t.missedIngredients.map(u => translateEngToTur(u.name)));

              const ingsDiv = document.createElement('div');
              ingsDiv.className = 'ings';
              ['Kullanƒ±labilir:', 'Eksik:'].forEach((lbl, idx) => {
                const block = document.createElement('div');
                const strong = document.createElement('strong');
                strong.textContent = lbl;
                block.appendChild(strong);
                const ul = document.createElement('ul');
                const arr = idx === 0 ? t.usedIngredients : t.missedIngredients;
                const names = idx === 0 ? usedTr : missedTr;
                arr.forEach((u, j) => {
                  const liU = document.createElement('li');
                  liU.textContent = `${names[j]} (${u.amount} ${u.unit})`;
                  ul.appendChild(liU);
                });
                block.appendChild(ul);
                ingsDiv.appendChild(block);
              });
              li.appendChild(ingsDiv);
              li.appendChild(document.createElement('hr'));

              // Ba≈ülƒ±ƒüa tƒ±klayƒ±nca adƒ±mlar
              titleEl.onclick = async () => {
                let instrDiv = li.querySelector('.instructions');
                if (instrDiv) {
                  instrDiv.style.display = instrDiv.style.display === 'block' ? 'none' : 'block';
                  return;
                }
                instrDiv = document.createElement('div');
                instrDiv.className = 'instructions';
                instrDiv.textContent = 'Y√ºkleniyor‚Ä¶';
                li.appendChild(instrDiv);

                try {
                  let info = await fetch(
                    `https://api.spoonacular.com/recipes/${t.id}/analyzedInstructions?apiKey=${apiKey}`
                  ).then(r => r.json());
                  let steps = info[0]?.steps?.map(s => s.step) || [];

                  if (!steps.length) {
                    const info2 = await fetch(
                      `https://api.spoonacular.com/recipes/${t.id}/information?includeNutrition=false&apiKey=${apiKey}`
                    ).then(r => r.json());
                    steps = info2.analyzedInstructions[0]?.steps?.map(s => s.step) || [];
                    if (!steps.length && info2.instructions) {
                      instrDiv.innerHTML = info2.instructions;
                      return;
                    }
                  }

                  if (steps.length) {
                    const trs = await Promise.all(steps.map(s => translateEngToTur(s)));
                    instrDiv.innerHTML = '<ol>' + trs.map(st => `<li>${st}</li>`).join('') + '</ol>';
                  } else {
                    instrDiv.textContent = 'Tarif adƒ±mlarƒ± bulunamadƒ±.';
                  }
                } catch {
                  instrDiv.textContent = 'Adƒ±mlar y√ºklenirken hata olu≈ütu.';
                }
              };

              ulResults.appendChild(li);
            }
          } catch {
            resultsContainer.style.display = 'block';
            msgDiv.textContent = 'Bir hata olu≈ütu, l√ºtfen konsolu kontrol edin.';
          }
        }, 2500);

      }

      searchBtn.addEventListener('click', searchRecipes);
    });
  </script>
</body>
</html>
