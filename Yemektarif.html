<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Tarif √ñneri Uygulamasƒ±</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Georgia, serif; }
    body { background: #0d1117; color: #c9d1d9; display: flex; flex-direction: column; align-items: center; padding: 2rem; }
    .container, .results-frame {
      background: #161b22;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
      width: 100%;
      max-width: 600px;
      margin-bottom: 1.5rem;
    }
    .container { padding: 2rem; }
    .container h1 { margin-bottom: 1rem; font-size: 1.8rem; text-align: center; color: #58a6ff; }
    .container p { margin-bottom: 0.5rem; }
    .container input {
      width: 100%; padding: 0.6rem; margin-bottom: 0.8rem;
      border: 1px solid #30363d; border-radius: 4px; font-size: 1rem;
      background: #0d1117; color: #c9d1d9;
    }
    .container button {
      width: 100%; padding: 0.7rem;
      background: #238636; color: #f0f6fc; border: none; border-radius: 4px;
      cursor: pointer; font-size: 1rem;
    }
    .container button:hover { background: #2ea043; }
    .contact { margin-top: 0.5rem; text-align: center; color: #8b949e; font-size: 0.9rem; }
    .contact a { color: #58a6ff; text-decoration: none; }

    .results-frame { display: none; padding: 2rem; }
    .results-frame h2 { font-size: 1.6rem; margin-bottom: 0.5rem; color: #58a6ff; }
    .hint { font-size: 0.9rem; margin-bottom: 1rem; color: #8b949e; }
    #message { margin-bottom: 1rem; font-style: italic; }
    #results { list-style: none; padding: 0; }
    #results li {
      background: #0d1117; margin-bottom: 1rem; padding: 1rem;
      border: 1px solid #30363d; border-radius: 6px;
    }
    .recipe-title {
      font-size: 1.3rem; margin-bottom: 0.6rem; color: #58a6ff;
      cursor: pointer;
    }
    .ings { display: flex; justify-content: space-between; }
    .ings div { width: 48%; }
    .ings strong { display: block; margin-bottom: 0.4rem; color: #ffea7f; }
    .ings ul { list-style: disc; margin-left: 1.2rem; }
    hr { border: none; border-top: 1px solid #30363d; margin: 1rem 0; }

    .instructions {
      background: #161b22; padding: 0.8rem; border-radius: 4px;
      margin-top: 0.5rem; color: #c9d1d9;
    }
    .instructions ol { margin-left: 1.2rem; }
    .instructions li { margin-bottom: 0.4rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Tarif √ñneri Botu üç≥</h1>
    <p>Elindeki malzemeleri virg√ºlle ayƒ±rƒ±p yaz:</p>
    <input type="text" id="ingredients" placeholder="√∂rn: patates, yumurta, un">
    <button id="searchBtn">Tarif Ara</button>
    <p class="contact">ƒ∞leti≈üim: <a href="mailto:Ali@Siber.NET">Ali@Siber.NET</a></p>
  </div>

  <div class="results-frame" id="results-container">
    <h2>Sonu√ßlar</h2>
    <p class="hint">Yapƒ±lƒ±≈üƒ±nƒ± g√∂rmek i√ßin ba≈ülƒ±ƒüa tƒ±kla</p>
    <div id="message"></div>
    <ul id="results"></ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const apiKey = '117f4267981845d5800cb8de69f44e23';

      // Basit T√ºrk√ße‚Üíƒ∞ngilizce haritasƒ±
      const translationMap = {
        patates: 'potato',
        yumurta: 'egg',
        un: 'flour',
        s√ºt: 'milk',
        yulaf: 'oats',
        √ßilek: 'strawberry',
        mango: 'mango'
      };

      function toEnglish(ing) {
        return translationMap[ing.toLowerCase()] || ing;
      }

      // LibreTranslate ile T√ºrk√ßeye √ßevir
      function toTurkish(text) {
        return fetch('https://libretranslate.com/translate', {
          method: 'POST',
          body: JSON.stringify({
            q: text,
            source: 'en',
            target: 'tr',
            format: 'text'
          }),
          headers: { 'Content-Type': 'application/json' }
        })
        .then(r => r.json())
        .then(j => j.translatedText)
        .catch(() => text);
      }

      const searchBtn = document.getElementById('searchBtn');
      const ingInput = document.getElementById('ingredients');
      const msgDiv = document.getElementById('message');
      const ulResults = document.getElementById('results');
      const resultsContainer = document.getElementById('results-container');

      async function searchRecipes() {
        const raw = ingInput.value.trim();
        if (!raw) return alert('L√ºtfen en az bir malzeme giriniz!');

        const ingList = raw.split(',').map(s => s.trim()).filter(Boolean);
        const query = ingList.map(toEnglish).join(',');

        resultsContainer.style.display = 'none';
        msgDiv.textContent = 'Tarif aranƒ±yor‚Ä¶ ‚è≥';
        ulResults.innerHTML = '';

        try {
          const res = await fetch(
            `https://api.spoonacular.com/recipes/findByIngredients?ingredients=${encodeURIComponent(query)}&number=5&apiKey=${apiKey}`
          );
          if (!res.ok) throw new Error(res.status);
          const data = await res.json();

          resultsContainer.style.display = 'block';
          if (!data.length) {
            msgDiv.textContent = 'Bu malzemelerle tarif bulunamadƒ± üòï';
            return;
          }
          msgDiv.textContent = `Bulunan ${data.length} tarif:`;

          for (let i = 0; i < data.length; i++) {
            const t = data[i];
            const usedTr = await Promise.all(t.usedIngredients.map(u => toTurkish(u.name)));
            const missedTr = await Promise.all(t.missedIngredients.map(u => toTurkish(u.name)));

            const li = document.createElement('li');
            const titleEl = document.createElement('div');
            titleEl.className = 'recipe-title';
            titleEl.dataset.id = t.id;
            titleEl.textContent = `${i+1}. ${t.title}`;
            toTurkish(t.title).then(tr => {
              titleEl.textContent = `${i+1}. ${tr}`;
            });
            li.appendChild(titleEl);

            const ingsDiv = document.createElement('div');
            ingsDiv.className = 'ings';

            const usedBlock = document.createElement('div');
            const su = document.createElement('strong');
            su.textContent = 'Kullanƒ±labilir:';
            usedBlock.appendChild(su);
            const ulU = document.createElement('ul');
            t.usedIngredients.forEach((u, idx) => {
              const liU = document.createElement('li');
              liU.textContent = `${usedTr[idx]} (${u.amount} ${u.unit})`;
              ulU.appendChild(liU);
            });
            usedBlock.appendChild(ulU);

            const missedBlock = document.createElement('div');
            const sm = document.createElement('strong');
            sm.textContent = 'Eksik:';
            missedBlock.appendChild(sm);
            const ulM = document.createElement('ul');
            t.missedIngredients.forEach((u, idx) => {
              const liM = document.createElement('li');
              liM.textContent = `${missedTr[idx]} (${u.amount} ${u.unit})`;
              ulM.appendChild(liM);
            });
            missedBlock.appendChild(ulM);

            ingsDiv.appendChild(usedBlock);
            ingsDiv.appendChild(missedBlock);
            li.appendChild(ingsDiv);
            li.appendChild(document.createElement('hr'));

            titleEl.onclick = async () => {
              let instrDiv = li.querySelector('.instructions');
              if (instrDiv) {
                instrDiv.style.display = instrDiv.style.display === 'block' ? 'none' : 'block';
                return;
              }
              instrDiv = document.createElement('div');
              instrDiv.className = 'instructions';
              instrDiv.textContent = 'Y√ºkleniyor‚Ä¶';
              li.appendChild(instrDiv);

              try {
                let info = await fetch(
                  `https://api.spoonacular.com/recipes/${t.id}/analyzedInstructions?apiKey=${apiKey}`
                ).then(r => r.json());
                let steps = info[0]?.steps?.map(s => s.step) || [];

                if (!steps.length) {
                  const info2 = await fetch(
                    `https://api.spoonacular.com/recipes/${t.id}/information?includeNutrition=false&apiKey=${apiKey}`
                  ).then(r => r.json());
                  steps = info2.analyzedInstructions[0]?.steps?.map(s => s.step) || [];
                  if (!steps.length && info2.instructions) {
                    instrDiv.innerHTML = info2.instructions;
                    return;
                  }
                }

                if (steps.length) {
                  const trs = await Promise.all(steps.map(s => toTurkish(s)));
                  instrDiv.innerHTML = '<ol>' + trs.map(st => `<li>${st}</li>`).join('') + '</ol>';
                } else {
                  instrDiv.textContent = 'Tarif adƒ±mlarƒ± bulunamadƒ±.';
                }
              } catch (e) {
                console.error(e);
                instrDiv.textContent = 'Adƒ±mlar y√ºklenirken hata olu≈ütu.';
              }
            };

            ulResults.appendChild(li);
          }
        } catch (err) {
          console.error(err);
          resultsContainer.style.display = 'block';
          msgDiv.textContent = 'Bir hata olu≈ütu, l√ºtfen konsolu kontrol edin.';
        }
      }

      searchBtn.addEventListener('click', searchRecipes);
    });
  </script>
</body>
</html>
