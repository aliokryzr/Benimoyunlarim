 <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const clickToStart = document.getElementById('clickToStart');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const restartButton = document.getElementById('restartButton');
    const mainMenu = document.getElementById('mainMenu');
    const gameContainer = document.getElementById('gameContainer');
    const nicknameInput = document.getElementById('nicknameInput');
    const startButton = document.getElementById('startButton');
    const currentScoreDisplay = document.getElementById('currentScore');
    const topScoresList = document.getElementById('topScores');
    const liveScoresList = document.getElementById('liveScores');

    const gridSize = 20;
    const tileCount = canvas.width / gridSize;

    let snake = [];
    let velocityX = 0;
    let velocityY = 0;
    let apple = {};
    let superApple = null;
    let score = 0;
    let normalAppleCount = 0; 
    let isRunning = false;
    let isPaused = false;
    let gameInterval;
    let nickname = '';
    let hasStarted = false;


    function loadScores() {
      let storedScores = localStorage.getItem('snakeHighScores');
      if (storedScores) {
        return JSON.parse(storedScores);
      }
      return [];
    }

    function saveScores(scores) {
      localStorage.setItem('snakeHighScores', JSON.stringify(scores));
    }


    function updateScoreLists() {
      const scores = loadScores();
      // Ana menüdeki liste
      topScoresList.innerHTML = '';
      scores.forEach(({name, score}, i) => {
        const li = document.createElement('li');
        li.textContent = `${name}: ${score}`;
        topScoresList.appendChild(li);
      });


      liveScoresList.innerHTML = '';
      scores.forEach(({name, score}) => {
        const li = document.createElement('li');
        li.textContent = `${name}: ${score}`;
        liveScoresList.appendChild(li);
      });
    }


    function placeApple() {
      apple.x = Math.floor(Math.random() * tileCount);
      apple.y = Math.floor(Math.random() * tileCount);

      
      if (snake.some(segment => segment.x === apple.x && segment.y === apple.y) ||
          (superApple && superApple.x === apple.x && superApple.y === apple.y)) {
        placeApple();
      }
    }


    function placeSuperApple() {
      superApple = {};
      superApple.x = Math.floor(Math.random() * tileCount);
      superApple.y = Math.floor(Math.random() * tileCount);

     
      if (snake.some(segment => segment.x === superApple.x && segment.y === superApple.y) ||
          (apple.x === superApple.x && apple.y === superApple.y)) {
        placeSuperApple();
      }
    }


    function startGame() {
      if (!nickname.trim()) {
        alert('Lütfen kullanıcı adınızı girin.');
        return;
      }


      mainMenu.style.display = 'none';
      gameContainer.style.display = 'flex';


      snake = [
        {x: 8, y: 10},
        {x: 7, y: 10},
        {x: 6, y: 10}
      ];
      velocityX = 1;
      velocityY = 0;
      score = 0;
      normalAppleCount = 0;
      currentScoreDisplay.textContent = 'Skor: 0';
      superApple = null; 
      placeApple();
      isPaused = false;
      isRunning = false;
      hasStarted = false;
      clickToStart.style.display = 'block';
      gameOverScreen.style.display = 'none';

      updateScoreLists();
      drawGame();
    }


    function drawGame() {
      // Arka plan
      ctx.fillStyle = '#111';
      ctx.fillRect(0, 0, canvas.width, canvas.height);


      if (!superApple) { 
        ctx.fillStyle = '#ff4444';
        ctx.beginPath();
        const appleCenterX = apple.x * gridSize + gridSize / 2;
        const appleCenterY = apple.y * gridSize + gridSize / 2;
        ctx.arc(appleCenterX, appleCenterY, gridSize / 2.5, 0, Math.PI * 2);
        ctx.fill();
      }


      if (superApple) {
        ctx.fillStyle = '#ffd700'; 
        ctx.beginPath();
        const superCenterX = superApple.x * gridSize + gridSize / 2;
        const superCenterY = superApple.y * gridSize + gridSize / 2;
        ctx.arc(superCenterX, superCenterY, gridSize / 2.5, 0, Math.PI * 2);
        ctx.fill();

      
      }

  
      snake.forEach((segment, index) => {
        ctx.fillStyle = index === 0 ? '#00ffff' : '#00cccc';
        ctx.strokeStyle = '#005555';
        ctx.lineWidth = 2;

        const centerX = segment.x * gridSize + gridSize / 2;
        const centerY = segment.y * gridSize + gridSize / 2;
        const radius = gridSize / 2.5;

        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
      });
    }


    function gameStep() {
      if (isPaused) return;


      const headX = snake[0].x + velocityX;
      const headY = snake[0].y + velocityY;

   
      if (headX < 0 || headX >= tileCount || headY < 0 || headY >= tileCount) {
        endGame();
        return;
      }
    
      if (snake.some(segment => segment.x === headX && segment.y === headY)) {
        endGame();
        return;
      }

 
      snake.unshift({x: headX, y: headY});



      if (superApple && headX === superApple.x && headY === superApple.y) {
     
        score += 50;
        currentScoreDisplay.textContent = `Skor: ${score}`;
        superApple = null;
        normalAppleCount = 0; 
        placeApple();
      }
      else if (!superApple && headX === apple.x && headY === apple.y) {
        
        score += 1;
        currentScoreDisplay.textContent = `Skor: ${score}`;
        normalAppleCount++;
        if (normalAppleCount >= 10) {
          
          superApple = {};
          placeSuperApple();
        } else {
          placeApple();
        }
      } else {
      
        snake.pop();
      }

      drawGame();
    }

 
    function endGame() {
      isPaused = true;
      isRunning = false;
      hasStarted = false;
      clickToStart.style.display = 'none';

  
      let scores = loadScores();
      scores.push({name: nickname, score});
      scores.sort((a,b) => b.score - a.score);
      if (scores.length > 10) scores.length = 10; 
      saveScores(scores);
      updateScoreLists();

      
      gameOverScreen.style.display = 'block';
    }

 
    window.addEventListener('keydown', (e) => {
  const keys = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];

  if (keys.includes(e.key)) {
    e.preventDefault(); 
  }

  if (!isRunning && !hasStarted) return; 

  switch (e.key) {
    case 'ArrowUp':
      if (velocityY !== 1) { velocityX = 0; velocityY = -1; }
      break;
    case 'ArrowDown':
      if (velocityY !== -1) { velocityX = 0; velocityY = 1; }
      break;
    case 'ArrowLeft':
      if (velocityX !== 1) { velocityX = -1; velocityY = 0; }
      break;
    case 'ArrowRight':
      if (velocityX !== -1) { velocityX = 1; velocityY = 0; }
      break;
    case ' ':
      if (!hasStarted) return;
      if (isPaused) {
        isPaused = false;
        currentScoreDisplay.textContent = `Skor: ${score}`;
      } else {
        isPaused = true;
        currentScoreDisplay.textContent = `Oyun Duraklatıldı (Boşluk ile devam ettir)`;
      }
      break;
  }
});



    startButton.addEventListener('click', () => {
      nickname = nicknameInput.value.trim();
      if (!nickname) {
        alert('Lütfen kullanıcı adınızı girin.');
        nicknameInput.focus();
        return;
      }
      startGame();
    });

   
    function runGameLoop() {
      if (gameInterval) clearInterval(gameInterval);
      gameInterval = setInterval(gameStep, 120);
    }


    clickToStart.addEventListener('click', () => {
      if (!hasStarted) {
        isRunning = true;
        isPaused = false;
        hasStarted = true;
        clickToStart.style.display = 'none';
        runGameLoop();
      }
    });

 
    restartButton.addEventListener('click', () => {
      // Oyun ekranını gizle, ana menüyü göster
      gameContainer.style.display = 'none';
      mainMenu.style.display = 'flex';

    
      nicknameInput.value = '';
      nicknameInput.focus();

      gameOverScreen.style.display = 'none';
      if (gameInterval) clearInterval(gameInterval);
      isRunning = false;
      isPaused = false;
      hasStarted = false;
      updateScoreLists();
    });

   
    updateScoreLists();
</script>
